<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Alterar Pergunta (Anna)</title>
  <style>
    #form-edicao-discursiva, #form-edicao-multipla {
        display: none;
    }
  </style>
</head>
<body>
  <h2>Alterar Questão</h2>

  <label for="tipo-questao">Tipo de Questão:</label>
  <select id="tipo-questao">
      <option value="discursiva">Discursiva</option>
      <option value="multipla">Múltipla Escolha</option>
  </select>

  <label for="id-busca">ID da Questão:</label>
  <input type="text" id="id-busca" required>
  <button onclick="encontrar()">Encontrar</button>

  <br><br>
  
  <div id="form-edicao-discursiva">
    <h4>Editando Questão Discursiva</h4>
    <form onsubmit="event.preventDefault(); salvarDiscursiva();"> 
      <input type="hidden" id="form-discursiva-id">
      
      <label for="form-discursiva-pergunta">Novo texto da pergunta:</label><br>
      <textarea id="form-discursiva-pergunta" rows="4" cols="50"></textarea><br><br>
      
      <label for="form-discursiva-resposta">Nova resposta:</label><br>
      <textarea id="form-discursiva-resposta" rows="4" cols="50"></textarea><br><br>

      <button type="submit">Salvar Alterações</button>
    </form>
  </div>
  
  <div id="form-edicao-multipla">
    <h4>Editando Questão Múltipla Escolha</h4>
    <form onsubmit="event.preventDefault(); salvarMultipla();"> 
      <input type="hidden" id="form-multipla-id">
      
      <label for="form-multipla-pergunta">Novo texto da pergunta:</label><br>
      <textarea id="form-multipla-pergunta" rows="4" cols="50"></textarea><br><br>
      
      <label for="form-multipla-opc1">Opção A:</label><br>
      <input type="text" id="form-multipla-opc1" size="50"><br><br>
      
      <label for="form-multipla-opc2">Opção B:</label><br>
      <input type="text" id="form-multipla-opc2" size="50"><br><br>
      
      <label for="form-multipla-opc3">Opção C:</label><br>
      <input type="text" id="form-multipla-opc3" size="50"><br><br>
      
      <label for="form-multipla-opc4">Opção D:</label><br>
      <input type="text" id="form-multipla-opc4" size="50"><br><br>
      
      <label for="form-multipla-correta">Resposta Correta:</label><br>
      <input type="text" id="form-multipla-correta" size="50"><br><br>

      <button type="submit">Salvar Alterações</button>
    </form>
  </div>
  
  <p id="status-salvar"></p>

  <script>
    function encontrar() {
      const id = document.getElementById("id-busca").value;
      const tipo = document.getElementById("tipo-questao").value;
      
      document.getElementById("form-edicao-discursiva").style.display = "none";
      document.getElementById("form-edicao-multipla").style.display = "none";

      const xmlhttp = new XMLHttpRequest();
      xmlhttp.open("GET", `buscarpergunta.php?id=${id}&tipo=${tipo}`);

      xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState === 4) {
          if (xmlhttp.status === 200) {
            const respostaJson = JSON.parse(xmlhttp.responseText);
            if (respostaJson.erro) {
              alert(respostaJson.erro);
            } else {
              if (tipo === 'discursiva') {
                preencherFormDiscursiva(respostaJson);
              } else if (tipo === 'multipla') {
                preencherFormMultipla(respostaJson);
              }
            }
          } else {
            alert("Erro ao buscar: " + xmlhttp.status);
          }
        }
      };
      xmlhttp.send();
    }
    
    function preencherFormDiscursiva(dados) {
        document.getElementById("form-discursiva-id").value = dados[0];
        document.getElementById("form-discursiva-pergunta").value = dados[1];
        document.getElementById("form-discursiva-resposta").value = dados[2];
        document.getElementById("form-edicao-discursiva").style.display = "block";
    }
    
    function preencherFormMultipla(dados) {
        document.getElementById("form-multipla-id").value = dados[0];
        document.getElementById("form-multipla-pergunta").value = dados[1];
        document.getElementById("form-multipla-opc1").value = dados[2];
        document.getElementById("form-multipla-opc2").value = dados[3];
        document.getElementById("form-multipla-opc3").value = dados[4];
        document.getElementById("form-multipla-opc4").value = dados[5];
        document.getElementById("form-multipla-correta").value = dados[6];
        document.getElementById("form-edicao-multipla").style.display = "block";
    }
    
    
    function salvarDiscursiva() {
        const dados = {
            tipo: "discursiva", 
            id_questao: document.getElementById("form-discursiva-id").value,
            texto_questao: document.getElementById("form-discursiva-pergunta").value,
            texto_resposta: document.getElementById("form-discursiva-resposta").value
        };
        enviarFormulario(dados);
    }
    
    function salvarMultipla() {
        const dados = {
            tipo: "multipla", // Informa o tipo!
            id_questao: document.getElementById("form-multipla-id").value,
            pergunta: document.getElementById("form-multipla-pergunta").value,
            opc1: document.getElementById("form-multipla-opc1").value,
            opc2: document.getElementById("form-multipla-opc2").value,
            opc3: document.getElementById("form-multipla-opc3").value,
            opc4: document.getElementById("form-multipla-opc4").value,
            resposta_certa: document.getElementById("form-multipla-correta").value
        };
        enviarFormulario(dados);
    }
    
    function enviarFormulario(dados) {
      const statusMsg = document.getElementById("status-salvar");
      statusMsg.innerHTML = "Salvando...";

      const json = JSON.stringify(dados);
      const xmlhttp = new XMLHttpRequest();
      
      xmlhttp.open("POST", "salvarpergunta.php", true); 
      xmlhttp.setRequestHeader("Content-Type", "application/json");

      xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState === 4) {
          if (xmlhttp.status === 200) {
            const resposta = JSON.parse(xmlhttp.responseText);
            if (resposta.status === 'sucesso') {
                statusMsg.innerHTML = resposta.mensagem;
                document.getElementById("form-edicao-discursiva").style.display = "none";
                document.getElementById("form-edicao-multipla").style.display = "none";
                document.getElementById("id-busca").value = "";
            } else {
                statusMsg.innerHTML = "Erro ao salvar: " + resposta.mensagem;
            }
          } else {
            statusMsg.innerHTML = "Erro de comunicação: " + xmlhttp.status;
          }
        }
      };
      
      xmlhttp.send(json);
    }
  </script>
</body>
</html>